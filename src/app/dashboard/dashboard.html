<div class="dashboard-container">
  <!-- Stats Cards -->
  <div class="stats-container">
    <mat-card class="stat-card-1">
      <mat-card-title>Total Requests</mat-card-title>
      <mat-card-content class="stat-value-1">{{ totalRequests }}</mat-card-content>
    </mat-card>

    <mat-card class="stat-card-2">
      <mat-card-title>Pending Requests</mat-card-title>
      <mat-card-content class="stat-value-2">{{ pendingRequests }}</mat-card-content>
    </mat-card>

    <mat-card class="stat-card-3">
      <mat-card-title>Completed Requests</mat-card-title>
      <mat-card-content class="stat-value-3">{{ completedRequests }}</mat-card-content>
    </mat-card>
  </div>


  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <span class="loading-text">Loading requests...</span>
  </div>

  
  <!-- Requests Table -->
  <div class="table-container" [class.loading]="isLoading">
    <mat-form-field class="filter-field">
      <mat-label>Filter</mat-label>
      <input
        matInput
        (keyup)="applyFilter($event)"
        placeholder="Ex. Vehicle No, Owner Name, Time, Date, etc."
        #input
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
      <!-- Vehicle No Column -->
      <ng-container matColumnDef="vehicleNo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Vehicle No.</th>
        <td mat-cell *matCellDef="let request">{{ request.vehicleNo }}</td>
      </ng-container>

      <!-- Owner Name Column -->
      <ng-container matColumnDef="ownerName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Owner Name</th>
        <td mat-cell *matCellDef="let request">{{ request.ownerName }}</td>
      </ng-container>

      <!-- Preferred Date Column -->
      <ng-container matColumnDef="preferredDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Preferred Date</th>
        <td mat-cell *matCellDef="let request">
          {{ formatDateForDisplay(request.preferredDate) }}
        </td>
      </ng-container>

      <!-- Preferred Time Column -->
      <ng-container matColumnDef="preferredTime">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Preferred Time</th>
        <td mat-cell *matCellDef="let request">{{ request.preferredTime }}</td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let request">
          <span class="status-badge" [ngClass]="'status-' + request.status">
            {{ request.status }}
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let request" class="action-buttons">
          <button 
            mat-icon-button 
            color="primary" 
            (click)="viewRequestDetails(request)"
            matTooltip="View Details">
            <mat-icon>visibility</mat-icon>
          </button>
          <button 
            mat-icon-button 
            color="primary" 
            (click)="approveRequest(request.id)"
            *ngIf="request.status === 'Pending'"
            matTooltip="Approve Request">
            <mat-icon>check_circle</mat-icon>
          </button>
          <button 
            mat-icon-button 
            color="warn" 
            (click)="rejectRequest(request.id)"
            *ngIf="request.status === 'Pending'"
            matTooltip="Reject Request">
            <mat-icon>cancel</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- Row shown when there is no matching data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          No data matching the filter "{{ input.value }}"
        </td>
      </tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
      aria-label="Select page of service requests">
    </mat-paginator>
  </div>
</div>